parameters:
  timezone: "%env(APP_TIMEZONE)%"
  front_url: "%env(FRONT_URL)%"
  kernel.logs_dir: '%kernel.project_dir%/var/log'
  pokemon_tcg_api_key: '%env(POKEMONTCG_API_KEY)%'

services:
  # default configuration for services in *this* file
  _defaults:
    autowire: true # Automatically injects dependencies in your services.
    autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

  # makes classes in src/ available to be used as services
  # this creates a service per class whose id is the fully-qualified class name
  App\:
    resource: "../src/"
    exclude:
      - "../src/DependencyInjection/"
      - "../src/Entity/"
      - "../src/Kernel.php"

  # add more service definitions when explicit configuration is needed
  # please note that last definitions always *replace* previous ones

  # Processeurs Monolog
  App\Logger\UserProcessor:
    tags:
      - { name: monolog.processor }

  App\Logger\RequestProcessor:
    tags:
      - { name: monolog.processor }

  # Service de logging centralisé avec channels dédiés
  App\Service\LoggerService:
    arguments:
      $logger: '@monolog.logger'
      $actionLogger: '@monolog.logger.action'
      $securityLogger: '@monolog.logger.security'
      $requestLogger: '@monolog.logger.request'
      $performanceLogger: '@monolog.logger.performance'

  # Formatters personnalisés
  monolog.formatter.monformat:
    class: Monolog\Formatter\LineFormatter
    arguments:
      - "[%%datetime%%][%%extra.user.identifier%%] %%channel%%.%%level_name%%: %%message%% %%context%% %%extra%%\n"

  # Rate Limiter Subscriber
  App\EventSubscriber\RateLimitSubscriber:
    arguments:
      $apiAnonymousLimiter: '@limiter.api_anonymous'
      $apiAuthenticatedLimiter: '@limiter.api_authenticated'
      $apiLoginLimiter: '@limiter.api_login'
      $apiRegisterLimiter: '@limiter.api_register'
      $security: '@security.helper'
      $logger: '@monolog.logger.security'
    tags:
      - { name: kernel.event_subscriber }
